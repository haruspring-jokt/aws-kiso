# CHAPTER2 ネットワークを構築する

## 2-1 ネットワークで用いるIPアドレス範囲を定める

- プライベートアドレス、パブリックアドレスの違い
- IPアドレス範囲と表記方法

このへんは何となく理解しているので読み流す。

今回は、

```
10.0.0.0/16
```

というCIDRブロックを利用して、プライベートIPアドレスのネットワーク空間を作成する。

## 2-2 実験用のVPCを作成する

物理的には「ルーターやハブを用意して、環境を整える作業」に相当する。

新規にVPCを作成する。以下のように設定して作成した。

![](https://i.imgur.com/dSuFN1s.jpg)

```
vpc-0a2b99cef569bd052 / VPC領域 が正常に作成されました
```

## 2-3 VPCをサブネットに分割する

サブネット：割り当てられたCIDRブロックを、更に小さなブロックに分割して利用する。これをサブネットと言う。

分ける理由は:

- 物理的な隔離
- セキュリティ上の理由

今回は、VPCを`/24`の大きさで切り、以下のように運用する。

- パブリックサブネット `10.0.1.0/24`
- プライベートサブネット `10.0.2.0/24`

「サブネット」メニューに移動し、サブネットを作成する。

その後、CIDRブロックを設定してパブリック・プライベートのそれぞれを作成していく。

![](https://i.imgur.com/ojDaiaE.jpg)

今回作成するのはパブリックサブネット `10.0.1.0/24` だけでOKっぽい。

## 2-4 インターネット回線とルーティング

作成したパブリックサブネットを、インターネットと接続する。

VPCでは、インターネットゲートウェイを用いて回線を引き込むことができる。

「インターネットゲートウェイ」メニューを開き、作成する。

![](https://i.imgur.com/ZrXq0QQ.jpg)

次に、ルートテーブルの設定を行う。TCP/IPプロトコルで送受信されるパケットのヘッダー情報に「宛先IPアドレス」があり、どのネットワークに流すべきかの設定をルートテーブルによって行っている（と認識したけどあんまりわかっていない）。

VPCではサブネットごとにルートテーブルを設定できる。AWSでは、実際にルーターを意識する必要はない。

サブネット作成後、デフォルトではルートテーブルの設定は以下のようになっている。

この状態では、「`10.0.0.0/16`の範囲外の宛先のパケットは、全て破棄される」ことを示している。

![](https://i.imgur.com/h5M7Yuo.jpg)

これを、インターネットに接続できるようにしたいので、「`10.0.0.0/16`以外の宛先のパケット」を先程作成したインターネットゲートウェイに転送するよう、ルートテーブルを変更する。

新規にルートテーブルを作成する。VPCの指定を忘れないこと。

![](https://i.imgur.com/dPU41Af.jpg)

ルートを編集し、さっき作成したインターネットゲートウェイへのルートを追加する。

![](https://i.imgur.com/7RzrFZo.jpg)

サブネットにルートテーブルが追加されていればOK。
