# 3章 サーバーを構築する

## 仮想サーバーを構築する

前章で作成したパブリックサブネットの中に、仮想サーバー（インスタンス）を構築する。

- EC2メニューを開く
- インスタンスの起動
- AMIはAmazon Linux2を選択する
- t2.microを選択
- 次のステップへ
- ネットワーク: 「VPC領域」
- サブネット: 「パブリックサブネット」を選択
- 自動割り当てパブリックIP: 「有効」を選択
- ネットワークインターフェイス > プライマリIP: `10.0.1.10` を入力
- 次のステップへ
- ストレージはデフォルトのまま次のステップへ
- タグに「Name: Webサーバー」と入力し次へ
- セキュリティグループはそのまま新しく作成する。セキュリティテーブル名だけ変更する。
  - ![](https://i.imgur.com/JBg9OAP.jpg)

作成するとSSHキーがもらえるので保存する。Githubにあげるとまずいことは知っているぞ

![](https://i.imgur.com/13169CY.jpg)

キーをダウンロードしたらインスタンスを作成する。

作成が完了すると起動し、パブリックIPアドレスも確認することが可能になる。

### SSHで接続する

Macで作業しているのでコマンドライン上でサクッと接続できた。

```
 ~/w/aws-kiso   *…  ssh -i my-key.pem ec2-user@13.231.133.60                                                                                                                                                     土  6/ 5 10:23:05 2021

       __|  __|_  )
       _|  (     /   Amazon Linux 2 AMI
      ___|\___|___|

https://aws.amazon.com/amazon-linux-2/
6 package(s) needed for security, out of 17 available
Run "sudo yum update" to apply all updates.
[ec2-user@ip-10-0-1-10 ~]$ 
```

IPアドレスは固定化されていないので、固定したい場合は「Elastic IP」を使用する。今回はまだ使用しないっぽい。

## 3-3 IPアドレスとポート番号

## 3-4 ファイアウォールで接続制限する

ファイアウォールの最もかんたんな構造のものが、パケットフィルタリング。

- セキュリティグループメニューを開く。
- 「WEB-SG」を選択する。

![](https://i.imgur.com/Gmurizy.jpg)

現在は、SSH（22番ポート）以外は接続できないようになっている。